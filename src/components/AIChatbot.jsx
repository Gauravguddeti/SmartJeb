import React, { useState, useRef, useEffect } from 'react';
import { MessageCircle, X, Send, Sparkles, Bot, User } from 'lucide-react';

/**
 * AI Chatbot Component - Gen Z Financial Assistant
 */
const AIChatbot = () => {
  const [isOpen, setIsOpen] = useState(true);
  const [isExpanded, setIsExpanded] = useState(false);
  const [conversationContext, setConversationContext] = useState({
    lastTopic: null,
    waitingForGoal: false,
    savingsAmount: null,
    timeframe: null
  });
  const [messages, setMessages] = useState([
    {
      id: 1,
      type: 'bot',
      content: "Hey there! üëã I'm SmartJeb, your AI financial assistant. I'm here to help you with literally anything - money questions, life advice, calculations, budgeting tips, or just having a friendly conversation! What's on your mind today?",
      timestamp: new Date()
    }
  ]);
  const [inputMessage, setInputMessage] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  // Enhanced AI responses with context awareness and better NLP
  const generateResponse = (message) => {
    const lowerMessage = message.toLowerCase();
    
    // Context-aware responses for follow-ups
    if (conversationContext.waitingForGoal) {
      // User is responding to "What's this for?" question
      if (lowerMessage.includes('monitor') || lowerMessage.includes('computer') || lowerMessage.includes('screen') || lowerMessage.includes('display')) {
        setConversationContext({...conversationContext, waitingForGoal: false, lastTopic: 'monitor'});
        return "Perfect! A monitor is a great investment! üñ•Ô∏è Here's your tailored savings plan for ‚Çπ10,000 monitor:\n\nüí° **Monitor-Specific Strategy:**\n‚Ä¢ **Research first**: Check for sales, discounts, or upcoming festivals\n‚Ä¢ **Compare models**: Make a wishlist of 2-3 monitors to track prices\n‚Ä¢ **Timing advantage**: Electronics often go on sale during festivals\n\nüéØ **Accelerated Savings Tips:**\n\n**Week 1-4: Tech-focused savings**\n‚Ä¢ Skip gaming purchases/subscriptions: ‚Çπ500-800/week\n‚Ä¢ Reduce streaming services: ‚Çπ200-400/week\n‚Ä¢ Eat home more (invest food money in monitor): ‚Çπ600-900/week\n\n**Week 5-8: Side income boost**\n‚Ä¢ Sell old electronics/gadgets: ‚Çπ1,000-3,000\n‚Ä¢ Freelance your skills online: ‚Çπ2,000-5,000\n‚Ä¢ Part-time gigs on weekends: ‚Çπ1,500-3,000\n\n**Week 9-12: Final push**\n‚Ä¢ Monitor price tracking (buy during sales): Save 10-20%\n‚Ä¢ Use cashback apps for purchase: ‚Çπ200-500 back\n‚Ä¢ Consider EMI if 0% interest available\n\nüî• **Pro tip**: Follow the monitor on price tracking websites. You might get it for ‚Çπ8,000-9,000 during sales!\n\nWhat size/type of monitor are you looking at? Gaming, work, or general use?";
      }
      
      if (lowerMessage.includes('bike') || lowerMessage.includes('motorcycle') || lowerMessage.includes('scooter')) {
        setConversationContext({...conversationContext, waitingForGoal: false, lastTopic: 'vehicle'});
        return "A bike/scooter! Smart choice for transportation! üèçÔ∏è Here's your vehicle savings strategy:\n\n**Transportation-focused savings plan:**\n‚Ä¢ Use current transport savings toward goal\n‚Ä¢ Calculate monthly transport costs vs EMI benefits\n‚Ä¢ Consider used vehicles for better value\n‚Ä¢ Factor in insurance, registration costs\n\nWould you like me to help calculate the total cost including insurance and registration?";
      }
      
      if (lowerMessage.includes('phone') || lowerMessage.includes('mobile') || lowerMessage.includes('smartphone')) {
        setConversationContext({...conversationContext, waitingForGoal: false, lastTopic: 'phone'});
        return "A new phone! üì± Here's your smartphone savings strategy:\n\n**Phone-specific tips:**\n‚Ä¢ Wait for festival sales (save 15-25%)\n‚Ä¢ Consider exchange offers for old phone\n‚Ä¢ Compare online vs offline prices\n‚Ä¢ Check for bank offers and cashback\n\nWhat type of phone are you considering? Budget, mid-range, or flagship?";
      }
      
      if (lowerMessage.includes('laptop') || lowerMessage.includes('computer')) {
        setConversationContext({...conversationContext, waitingForGoal: false, lastTopic: 'laptop'});
        return "A laptop! Great for productivity! üíª Here's your laptop savings plan:\n\n**Laptop-focused strategy:**\n‚Ä¢ Student discounts if applicable\n‚Ä¢ Refurbished options for better value\n‚Ä¢ Specification research to avoid overpaying\n‚Ä¢ Extended warranty considerations\n\nWhat will you primarily use it for? Work, gaming, or general use?";
      }
      
      if (lowerMessage.includes('trip') || lowerMessage.includes('travel') || lowerMessage.includes('vacation') || lowerMessage.includes('holiday')) {
        setConversationContext({...conversationContext, waitingForGoal: false, lastTopic: 'travel'});
        return "A trip! Travel is the best investment! ‚úàÔ∏è Here's your travel savings strategy:\n\n**Travel-focused savings:**\n‚Ä¢ Book in advance for better deals\n‚Ä¢ Flexible dates for cheaper flights\n‚Ä¢ Budget accommodation research\n‚Ä¢ Local food vs expensive restaurants\n\nWhere are you planning to go? Domestic or international?";
      }
      
      if (lowerMessage.includes('emergency') || lowerMessage.includes('fund') || lowerMessage.includes('backup')) {
        setConversationContext({...conversationContext, waitingForGoal: false, lastTopic: 'emergency'});
        return "Emergency fund! You're being incredibly smart! üõ°Ô∏è This is the BEST financial decision:\n\n**Emergency fund strategy:**\n‚Ä¢ Keep in high-yield savings account\n‚Ä¢ Don't invest in risky assets\n‚Ä¢ Aim for 3-6 months of expenses eventually\n‚Ä¢ This ‚Çπ10,000 is a great start!\n\n**Motivation**: This money will give you peace of mind and financial security. Every rupee saved here is protecting your future!";
      }
      
      // Enhanced detection for simple follow-ups like "for a monitor"
      if (lowerMessage.startsWith('for ') || lowerMessage.startsWith('for a ') || lowerMessage.startsWith('for an ')) {
        // Extract the item after "for"
        const goalItem = lowerMessage.replace(/^for (a |an )?/, '').trim();
        
        if (goalItem.includes('monitor') || goalItem.includes('screen') || goalItem.includes('display')) {
          setConversationContext({...conversationContext, waitingForGoal: false, lastTopic: 'monitor'});
          return "Awesome! A monitor - excellent choice! üñ•Ô∏è Here's your monitor-specific savings plan:\n\nüí° **Smart Monitor Shopping:**\n‚Ä¢ Research during sales seasons (get 15-25% off)\n‚Ä¢ Compare 24\", 27\", or 32\" based on your needs\n‚Ä¢ Gaming vs work monitors have different priorities\n‚Ä¢ Check for dead pixels before buying\n\nüéØ **Monitor Savings Strategy:**\n\n**Immediate actions:**\n‚Ä¢ Create price alerts on Amazon/Flipkart\n‚Ä¢ Follow tech deal channels on Telegram\n‚Ä¢ Check offline stores for demo pieces (often discounted)\n\n**Weekly savings plan:**\n‚Ä¢ Week 1-4: Cut gaming/entertainment expenses (‚Çπ3,000)\n‚Ä¢ Week 5-8: Side hustles/selling old stuff (‚Çπ3,500)\n‚Ä¢ Week 9-12: Final push + timing the purchase (‚Çπ3,500)\n\n**Purchase timing:** Wait for upcoming sales or festivals to maximize savings!\n\nWhat type of monitor work are you planning - gaming, coding, design, or general use?";
        }
        
        if (goalItem.includes('phone') || goalItem.includes('mobile')) {
          setConversationContext({...conversationContext, waitingForGoal: false, lastTopic: 'phone'});
          return "A phone! üì± Smart timing - let me help you save effectively:\n\n**Phone-specific savings hacks:**\n‚Ä¢ Wait for festival sales or new model launches\n‚Ä¢ Your old phone exchange value matters\n‚Ä¢ Bank offers can save ‚Çπ1,000-3,000\n‚Ä¢ Compare online vs offline prices\n\nWhat's your target phone? Budget (‚Çπ10k-15k), mid-range (‚Çπ15k-30k), or premium?";
        }
        
        if (goalItem.includes('laptop') || goalItem.includes('computer')) {
          setConversationContext({...conversationContext, waitingForGoal: false, lastTopic: 'laptop'});
          return "A laptop! üíª Great investment in yourself. Here's how to save smart:\n\n**Laptop savings strategy:**\n‚Ä¢ Student discounts (if applicable) save 5-10%\n‚Ä¢ Refurbished/certified pre-owned options\n‚Ä¢ Timing: Buy during back-to-school sales\n‚Ä¢ Specs research prevents overspending\n\nWhat's the primary use? Programming, gaming, general work, or content creation?";
        }
        
        // Generic response for unrecognized "for X" items
        setConversationContext({...conversationContext, waitingForGoal: false, lastTopic: 'general'});
        return `Perfect! Saving for ${goalItem} - I love specific goals! üéØ\n\n**Your personalized ‚Çπ10,000 strategy:**\n‚Ä¢ Research the best time to buy (sales, discounts)\n‚Ä¢ Set up price alerts if it's available online\n‚Ä¢ Consider if there are seasonal patterns for pricing\n‚Ä¢ Factor in any additional costs (accessories, etc.)\n\n**3-month savings breakdown:**\n‚Ä¢ Month 1: ‚Çπ3,333 (focus on cutting unnecessary expenses)\n‚Ä¢ Month 2: ‚Çπ3,333 (find ways to earn extra)\n‚Ä¢ Month 3: ‚Çπ3,334 (final push + smart purchase timing)\n\nNeed specific tips for finding the best deals on ${goalItem}?`;
      }
      
      // Generic goal response for unrecognized items
      setConversationContext({...conversationContext, waitingForGoal: false, lastTopic: 'general'});
      return `Awesome goal! üéØ Here's your customized savings plan for ${message}:\n\n**Smart saving approach:**\n‚Ä¢ Research the best deals and timing\n‚Ä¢ Set up a dedicated savings account for this goal\n‚Ä¢ Track progress weekly to stay motivated\n‚Ä¢ Consider if there are seasonal discounts\n\n**Additional tips:**\n‚Ä¢ Look for online reviews before purchasing\n‚Ä¢ Compare prices across multiple platforms\n‚Ä¢ See if you can get better value by waiting\n‚Ä¢ Factor in any additional costs (accessories, maintenance)\n\nHaving a specific goal makes saving so much easier! You've got this! üí™\n\nNeed help with anything else about reaching this goal?`;
    }
    
    // Enhanced follow-up question handling based on conversation context
    if (conversationContext.lastTopic && !conversationContext.waitingForGoal) {
      // Monitor-related follow-ups
      if (conversationContext.lastTopic === 'monitor') {
        if (lowerMessage.includes('gaming') || lowerMessage.includes('game')) {
          return "Gaming monitor! üéÆ Perfect choice! Here's what to focus on:\n\n**Gaming monitor priorities:**\n‚Ä¢ **High refresh rate** (144Hz minimum, 240Hz ideal)\n‚Ä¢ **Low input lag** (1ms response time)\n‚Ä¢ **Resolution vs performance** (1080p for high FPS, 1440p for quality)\n‚Ä¢ **Adaptive sync** (FreeSync/G-Sync)\n\n**Budget allocation for ‚Çπ10,000:**\n‚Ä¢ ‚Çπ8,000-9,000 for monitor (during sales)\n‚Ä¢ ‚Çπ1,000-2,000 for accessories (arm mount, cables)\n\n**Best time to buy:** During gaming sales events or new GPU launches when older monitors get discounted!\n\nWhat games do you mainly play? Competitive FPS or single-player adventures?";
        }
        
        if (lowerMessage.includes('work') || lowerMessage.includes('office') || lowerMessage.includes('productivity')) {
          return "Work monitor! üíº Excellent productivity investment:\n\n**Work monitor priorities:**\n‚Ä¢ **Size matters** (27\" minimum for productivity)\n‚Ä¢ **Resolution** (1440p sweet spot for text clarity)\n‚Ä¢ **Ergonomics** (adjustable height/tilt)\n‚Ä¢ **Eye comfort** (blue light reduction, flicker-free)\n\n**Productivity features to look for:**\n‚Ä¢ USB-C connectivity (single cable setup)\n‚Ä¢ Multiple inputs (switch between devices)\n‚Ä¢ Built-in USB hub\n‚Ä¢ Pivot capability (portrait mode)\n\n**ROI calculation:** A good monitor improves productivity by 20-30%. If you earn ‚Çπ20,000/month, this pays for itself in increased efficiency!\n\nWhat type of work do you do? Programming, design, data analysis, or general office tasks?";
        }
        
        if (lowerMessage.includes('size') || lowerMessage.includes('24') || lowerMessage.includes('27') || lowerMessage.includes('32')) {
          return "Monitor size - crucial decision! üìè\n\n**Size guide for ‚Çπ10,000 budget:**\n\n**24\" (‚Çπ6,000-8,000):**\n‚Ä¢ Perfect for small desks\n‚Ä¢ Good for competitive gaming\n‚Ä¢ Less strain for close viewing\n‚Ä¢ More budget left for higher refresh rate\n\n**27\" (‚Çπ8,000-12,000):**\n‚Ä¢ Sweet spot for most users\n‚Ä¢ Great for productivity + gaming\n‚Ä¢ 1440p looks amazing at this size\n‚Ä¢ Most popular choice\n\n**32\" (‚Çπ12,000+):**\n‚Ä¢ Might exceed budget unless on heavy discount\n‚Ä¢ Awesome for immersive gaming\n‚Ä¢ Great for content creation\n‚Ä¢ Consider curved at this size\n\n**My recommendation:** 27\" 1440p during sales for ‚Çπ9,000-10,000. Best bang for buck!\n\nHow far do you sit from your desk? That affects the ideal size too!";
        }
      }
      
      // Phone-related follow-ups
      if (conversationContext.lastTopic === 'phone') {
        if (lowerMessage.includes('budget') || lowerMessage.includes('cheap') || lowerMessage.includes('affordable')) {
          return "Budget phone strategy! üì± Smart approach:\n\n**Best budget phones for ‚Çπ10,000:**\n‚Ä¢ Redmi/Realme series (great value)\n‚Ä¢ Samsung Galaxy M series\n‚Ä¢ Consider 6-month old flagships\n\n**Budget phone savings tips:**\n‚Ä¢ Buy during festival sales (save ‚Çπ1,500-2,500)\n‚Ä¢ Consider exchange offers\n‚Ä¢ Check for bank discounts\n‚Ä¢ Older generation flagships > new budget phones\n\n**What to prioritize in budget:**\n‚Ä¢ Good processor (daily performance)\n‚Ä¢ Decent camera (if you take photos)\n‚Ä¢ Battery life (heavy usage)\n‚Ä¢ Software updates (longevity)\n\nAny specific features you can't compromise on? Camera, gaming, battery life?";
        }
        
        if (lowerMessage.includes('camera') || lowerMessage.includes('photo')) {
          return "Camera-focused phone! üì∏ Here's how to maximize your budget:\n\n**Camera priorities for ‚Çπ10,000:**\n‚Ä¢ Look for phones with larger sensors\n‚Ä¢ Night mode capability\n‚Ä¢ Optical image stabilization (OIS)\n‚Ä¢ Multiple lenses (ultra-wide, macro)\n\n**Photography phone tips:**\n‚Ä¢ Pixel phones often have best computational photography\n‚Ä¢ iPhone SE (older model) might be available in budget\n‚Ä¢ Samsung A-series for versatile camera setup\n\n**Timing strategy:**\n‚Ä¢ Buy when new camera phones launch (older ones get discounted)\n‚Ä¢ Check for camera-focused sales events\n\nDo you mainly take portraits, landscapes, or need good video recording?";
        }
      }
      
      // Laptop-related follow-ups
      if (conversationContext.lastTopic === 'laptop') {
        if (lowerMessage.includes('programming') || lowerMessage.includes('coding') || lowerMessage.includes('development')) {
          return "Programming laptop! üíª Here's your developer-focused strategy:\n\n**Programming priorities for ‚Çπ10,000:**\n‚Ä¢ **RAM**: 8GB minimum (16GB ideal for multitasking)\n‚Ä¢ **SSD**: Faster than HDD for code compilation\n‚Ä¢ **Processor**: Intel i5/AMD Ryzen 5 minimum\n‚Ä¢ **Keyboard**: Good typing experience matters!\n\n**Developer laptop tips:**\n‚Ä¢ Refurbished ThinkPads are excellent value\n‚Ä¢ Consider business laptops (built for durability)\n‚Ä¢ Check for student discounts\n‚Ä¢ Linux compatibility if you prefer open source\n\n**Budget extension idea:** ‚Çπ10,000 might be tight for new. Consider:\n‚Ä¢ ‚Çπ15,000 budget with ‚Çπ5,000 from side projects\n‚Ä¢ Refurbished business laptops\n‚Ä¢ EMI options with 0% interest\n\nWhat programming languages/frameworks do you work with?";
        }
        
        if (lowerMessage.includes('gaming') || lowerMessage.includes('game')) {
          return "Gaming laptop for ‚Çπ10,000? üéÆ Let's be realistic:\n\n**Hard truth:** ‚Çπ10,000 won't get you a good gaming laptop. Here are better approaches:\n\n**Option 1: Extend budget**\n‚Ä¢ Gaming laptops start around ‚Çπ40,000-50,000\n‚Ä¢ Save for 6 months instead of 3\n‚Ä¢ Consider EMI options\n\n**Option 2: Desktop gaming**\n‚Ä¢ ‚Çπ10,000 can upgrade an existing desktop\n‚Ä¢ Better price-to-performance ratio\n‚Ä¢ Upgradeable components\n\n**Option 3: Cloud gaming**\n‚Ä¢ Use current laptop + cloud gaming services\n‚Ä¢ Much cheaper monthly cost\n‚Ä¢ Try before investing in hardware\n\nWhat games do you want to play? I can suggest the minimum specs needed!";
        }
      }
    }
    
    // Greeting responses
    if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
      const greetings = [
        "Hey there! üëã I'm your personal financial assistant. I'm here to help you with literally anything - money questions, life advice, calculations, or just a friendly chat! What's on your mind today?",
        "Hello! üòä Great to see you! I'm here to help with whatever you need - whether it's budgeting, saving tips, investment advice, or even just random questions. Fire away!",
        "Hi! ‚ú® I'm your AI companion ready to tackle any question you throw at me. Financial planning, life advice, fun facts, calculations - I've got you covered!",
        "Hey! üåü Welcome to SmartJeb! I'm here as your personal assistant for everything - money management, general questions, advice, or just having a conversation. What can I help you with?"
      ];
      return greetings[Math.floor(Math.random() * greetings.length)];
    }

    // How much/calculation questions
    if (lowerMessage.includes('how much') || lowerMessage.includes('calculate') || lowerMessage.includes('if i save')) {
      if (lowerMessage.includes('10000') && (lowerMessage.includes('3 months') || lowerMessage.includes('3 month'))) {
        return "Perfect! Let me break down exactly how to save ‚Çπ10,000 in 3 months:\n\nüí∞ **Your Savings Plan:**\n‚Ä¢ **Daily target**: ‚Çπ111 per day (‚Çπ10,000 √∑ 90 days)\n‚Ä¢ **Weekly target**: ‚Çπ770 per week\n‚Ä¢ **Monthly target**: ‚Çπ3,333 per month\n\nüéØ **Practical Ways to Save ‚Çπ111 Daily:**\n‚Ä¢ Skip outside food once = ‚Çπ100-150 saved\n‚Ä¢ Use public transport instead of auto = ‚Çπ80-120 saved\n‚Ä¢ Make coffee at home = ‚Çπ50-80 saved\n‚Ä¢ Avoid impulse purchases = ‚Çπ50-100 saved\n\nüìä **Monthly Strategy:**\n‚Ä¢ Week 1: Focus on food expenses (‚Çπ800 saved)\n‚Ä¢ Week 2: Transportation savings (‚Çπ600 saved)\n‚Ä¢ Week 3: Entertainment cuts (‚Çπ700 saved)\n‚Ä¢ Week 4: Shopping discipline (‚Çπ900 saved)\n\n‚ú® **Pro Tips:**\n‚Ä¢ Set up auto-transfer of ‚Çπ111 daily\n‚Ä¢ Track progress weekly\n‚Ä¢ Reward yourself at month-end (within budget!)\n‚Ä¢ Find free entertainment alternatives\n\nYou've absolutely got this! Small daily actions = big results! üöÄ";
      }
      
      const calculationResponses = [
        "I love crunching numbers! üßÆ Give me the specifics and I'll break it down for you. Whether it's savings goals, EMI calculations, investment returns, or daily budgets - just tell me the amount and timeframe!",
        "Math mode activated! üìä Share your numbers with me - savings target, investment amount, monthly expenses, whatever you need calculated. I'll give you a detailed breakdown with practical tips!",
        "Let's do some financial math! üí° Tell me exactly what you want to calculate - monthly savings for a goal, compound interest, EMI amounts, or anything else. I'll make it simple and actionable!",
        "Calculator ready! ‚ö° Just give me the details - how much you want to save, invest, or spend, and over what period. I'll show you the daily, weekly, and monthly breakdown plus some smart strategies!"
      ];
      return calculationResponses[Math.floor(Math.random() * calculationResponses.length)];
    }

    // More specific patterns for the 10000 question - SET CONTEXT FOR FOLLOW-UP
    if ((lowerMessage.includes('10000') || lowerMessage.includes('ten thousand')) && (lowerMessage.includes('3 months') || lowerMessage.includes('3 month'))) {
      // Set context to wait for user's goal response
      setConversationContext({
        lastTopic: 'savings_plan',
        waitingForGoal: true,
        savingsAmount: 10000,
        timeframe: '3 months'
      });
      
      return "Awesome! ‚Çπ10,000 in 3 months is totally doable! üéØ\n\nüí∞ **Quick Math:**\n‚Ä¢ **Daily target**: ‚Çπ111 (‚Çπ10,000 √∑ 90 days)\n‚Ä¢ **Weekly target**: ‚Çπ770\n‚Ä¢ **Monthly target**: ‚Çπ3,333\n\nüöÄ **I can give you a super personalized savings strategy!**\n\nWhat's this ‚Çπ10,000 for? Tell me your goal and I'll tailor the perfect plan:\n‚Ä¢ Monitor/laptop/phone?\n‚Ä¢ Trip/vacation?\n‚Ä¢ Emergency fund?\n‚Ä¢ Something else awesome?\n\nThe more specific you are, the better tips I can give you! üòä";
    }

    // Specific question about wanting 10000 - ALSO SET CONTEXT
    if (lowerMessage.includes('want') && lowerMessage.includes('10000') && lowerMessage.includes('3 month')) {
      // Set context to wait for user's goal response
      setConversationContext({
        lastTopic: 'savings_plan',
        waitingForGoal: true,
        savingsAmount: 10000,
        timeframe: '3 months'
      });
      
      return "Perfect! You want ‚Çπ10,000 in 3 months - I love specific goals! üéØ\n\nüí∞ **The Math:**\n‚Ä¢ **‚Çπ111 per day** for 90 days = ‚Çπ10,000\n‚Ä¢ **‚Çπ770 per week** (easier to track weekly)\n‚Ä¢ **‚Çπ3,333 per month**\n\n‚ú® **Here's the thing** - I can give you WAY better advice if I know what this is for!\n\n**Tell me your goal:**\n‚Ä¢ Gaming setup/monitor?\n‚Ä¢ New phone/laptop?\n‚Ä¢ Trip somewhere amazing?\n‚Ä¢ Emergency fund (smart choice!)?\n‚Ä¢ Investment/course?\n‚Ä¢ Something else?\n\nOnce you tell me, I'll create a laser-focused savings strategy just for you! What's the goal? üòä";
    }

    // Budget and money management
    if (lowerMessage.includes('budget') || lowerMessage.includes('money') || lowerMessage.includes('spend') || lowerMessage.includes('expense')) {
      const budgetResponses = [
        "Budgeting doesn't have to be boring! üí™ Here's my human approach:\n\n**The 50/30/20 rule (but flexible):**\n‚Ä¢ 50% - Needs (rent, groceries, bills)\n‚Ä¢ 30% - Wants (entertainment, dining out)\n‚Ä¢ 20% - Savings & investments\n\n**Real talk:** Life happens! Some months you'll spend more on wants, others you'll save extra. The key is being aware and adjusting. Track for a week first to see where your money actually goes - you might be surprised! Want me to help you create a personalized budget?",
        "Let's talk money management like real humans! üí∞ Forget those strict budgets that make you feel guilty about buying coffee.\n\n**My practical approach:**\n1. **Pay yourself first** - Save before you spend\n2. **Automate everything** - Savings, bills, investments\n3. **The 24-hour rule** - Wait a day before big purchases\n4. **Track expenses for awareness** - Not judgment!\n5. **Build in guilt-free spending** - You deserve treats!\n\nWhat specific area of budgeting are you struggling with? I can give you personalized strategies that actually work in real life!",
        "Money management that doesn't suck! üéØ Here's what actually works:\n\n**Start small:** Track expenses for just one week. Don't change anything, just observe. You'll learn more about your habits than any budgeting app.\n\n**The envelope method (digital style):** Separate accounts for different purposes - one for bills, one for fun money, one for savings. It's like having different wallets.\n\n**Emergency fund first:** Even ‚Çπ50/day adds up to ‚Çπ18,250 in a year. Start there.\n\nWhat's your biggest money challenge right now? Let's solve it together with practical steps, not overwhelming spreadsheets!"
      ];
      return budgetResponses[Math.floor(Math.random() * budgetResponses.length)];
    }

    // Investment and savings
    if (lowerMessage.includes('invest') || lowerMessage.includes('sip') || lowerMessage.includes('mutual fund') || lowerMessage.includes('stock')) {
      const investmentResponses = [
        "Investing doesn't have to be scary! üìà Let me break it down human-style:\n\n**For beginners:**\n‚Ä¢ Start with SIPs in large-cap mutual funds (less risky)\n‚Ä¢ Even ‚Çπ500/month builds wealth over time\n‚Ä¢ Index funds are your best friend (low fees, market returns)\n‚Ä¢ Don't try to time the market - consistency wins\n\n**Golden rules:**\n1. Emergency fund first (3-6 months expenses)\n2. Start small and increase gradually\n3. Diversify (don't put all eggs in one basket)\n4. Think long-term (5+ years minimum)\n\nWant specific fund recommendations or help calculating returns? I can guide you through the whole process step by step!",
        "Investment talk! üöÄ I'll keep it real and practical:\n\n**The truth about investing:**\n‚Ä¢ You don't need lakhs to start - ‚Çπ500 SIP works\n‚Ä¢ Mutual funds > individual stocks for beginners\n‚Ä¢ Compound interest is literally magic over time\n‚Ä¢ Market volatility is normal - don't panic sell\n\n**My starter pack recommendation:**\n1. Emergency fund in savings account\n2. ELSS funds for tax saving\n3. Large-cap index fund for stability\n4. Mid-cap fund for growth (small portion)\n\n**Example:** ‚Çπ2000 SIP with 12% average returns = ‚Çπ4.6 lakhs in 10 years (you invested only ‚Çπ2.4 lakhs!)\n\nWhat's your investment timeline and risk appetite? Let me suggest something specific for you!"
      ];
      return investmentResponses[Math.floor(Math.random() * investmentResponses.length)];
    }

    // Savings specific
    if (lowerMessage.includes('save') || lowerMessage.includes('saving') || lowerMessage.includes('emergency fund')) {
      const savingsResponses = [
        "Savings goals are everything! üéØ Let's make it happen:\n\n**The psychology of saving:**\n‚Ä¢ Make it automatic (you won't miss what you don't see)\n‚Ä¢ Start ridiculously small to build the habit\n‚Ä¢ Celebrate small wins (every ‚Çπ1000 saved matters!)\n‚Ä¢ Visual progress tracking keeps you motivated\n\n**Practical saving hacks:**\n‚Ä¢ Round up purchases and save the difference\n‚Ä¢ Save any unexpected money (bonuses, gifts)\n‚Ä¢ Use the 52-week challenge (‚Çπ10 week 1, ‚Çπ20 week 2...)\n‚Ä¢ Create specific goals with deadlines\n\n**Emergency fund priority:** 3-6 months of expenses in a savings account. Not for investments - for peace of mind!\n\nWhat's your savings goal? Let me create a personalized plan that actually fits your lifestyle!",
        "Saving money is an art! üé® Here's my human approach:\n\n**Why people fail at saving:**\n‚Ä¢ Setting unrealistic targets\n‚Ä¢ No clear purpose\n‚Ä¢ Treating savings as leftover money\n‚Ä¢ No emergency buffer\n\n**What actually works:**\n1. **Pay yourself first** - Save before expenses\n2. **Automate transfers** - Remove willpower from equation\n3. **Specific goals** - 'Vacation fund' vs 'savings'\n4. **Track progress visually** - Charts, apps, whatever motivates you\n5. **Allow flexibility** - Life happens, adjust and continue\n\n**Quick win:** Start with ‚Çπ100/day for 30 days. That's ‚Çπ3000! Small amounts build confidence and habits.\n\nTell me your income and expenses - I'll help you find ‚Çπ5000-10000 to save monthly without feeling deprived!"
      ];
      return savingsResponses[Math.floor(Math.random() * savingsResponses.length)];
    }

    // Credit cards and debt
    if (lowerMessage.includes('credit') || lowerMessage.includes('debt') || lowerMessage.includes('loan') || lowerMessage.includes('emi')) {
      const debtResponses = [
        "Credit cards and debt - let's tackle this smartly! üí≥\n\n**Credit card wisdom:**\n‚Ä¢ Use it like cash - only spend what you have\n‚Ä¢ Pay FULL amount every month (interest rates are brutal)\n‚Ä¢ Keep utilization under 30% for good credit score\n‚Ä¢ Cashback/rewards are bonuses, not reasons to spend more\n\n**If you're in debt:**\n1. List all debts with interest rates\n2. Pay minimums on all, extra on highest interest\n3. Consider balance transfer to lower rates\n4. Stop using credit for new purchases\n5. Side hustle for extra debt payments\n\n**Credit score matters:** Good score = better loan rates, credit card approvals, even job opportunities.\n\nNeed help with debt payoff strategy? Share your debt details and I'll create a personalized plan!",
        "Debt management reality check! üí™\n\n**The truth about debt:**\n‚Ä¢ Not all debt is bad (education, home loans can be good)\n‚Ä¢ Credit card debt is wealth killer - tackle first\n‚Ä¢ EMIs should be max 40% of income\n‚Ä¢ Emergency fund prevents new debt\n\n**Debt freedom strategy:**\n1. **Emergency ‚Çπ10,000 first** (prevents new debt)\n2. **List all debts** - amount, interest rate, minimum payment\n3. **Avalanche method** - pay highest interest first\n4. **Snowball method** - pay smallest amount first (psychological wins)\n5. **Negotiate with banks** - they often reduce rates/amounts\n\n**Credit card hack:** Set up auto-pay for full amount. Never pay just minimum - it's a trap!\n\nWhat's your debt situation? I can help create a realistic payoff timeline with actionable steps!"
      ];
      return debtResponses[Math.floor(Math.random() * debtResponses.length)];
    }

    // Life advice and general questions
    if (lowerMessage.includes('advice') || lowerMessage.includes('help') || lowerMessage.includes('what should i') || lowerMessage.includes('life')) {
      const lifeAdvice = [
        "Life advice coming right up! üåü\n\n**Money mindset shifts that change everything:**\n‚Ä¢ Wealth is built through habits, not big wins\n‚Ä¢ Your worth isn't your net worth\n‚Ä¢ Financial security > showing off\n‚Ä¢ Invest in yourself first (skills, health, relationships)\n‚Ä¢ Money is a tool, not the goal\n\n**General life wisdom:**\n‚Ä¢ Start before you feel ready\n‚Ä¢ Consistency beats perfection\n‚Ä¢ Surround yourself with people who inspire you\n‚Ä¢ Learn something new every month\n‚Ä¢ Health is your real wealth\n\nWhat specific area of life are you thinking about? Career, relationships, personal growth, finances? I'm here to chat and help however I can!",
        "Here for all your life questions! üí´\n\n**Universal truths I've learned:**\n‚Ä¢ Your 20s are for learning, 30s for earning, 40s for living\n‚Ä¢ Invest in experiences and relationships over things\n‚Ä¢ Financial independence = freedom to choose\n‚Ä¢ Skills compound like investments\n‚Ä¢ Your network determines your net worth\n\n**Practical life advice:**\n1. **Build multiple income streams** - job security is myth\n2. **Learn high-value skills** - digital marketing, coding, communication\n3. **Take calculated risks** - biggest risk is not taking any\n4. **Document your journey** - you'll inspire others\n5. **Give back** - success feels empty without purpose\n\nWhat's on your mind? Career decisions, relationship advice, life goals? Let's figure it out together!"
      ];
      return lifeAdvice[Math.floor(Math.random() * lifeAdvice.length)];
    }

    // Technology and general knowledge
    if (lowerMessage.includes('technology') || lowerMessage.includes('app') || lowerMessage.includes('phone') || lowerMessage.includes('computer')) {
      const techResponses = [
        "Tech talk! üíª I love discussing technology and how it impacts our lives:\n\n**Financial tech that actually helps:**\n‚Ä¢ Expense tracking apps (like SmartJeb! üòâ)\n‚Ä¢ Investment platforms with low fees\n‚Ä¢ Banking apps with good UX\n‚Ä¢ Budgeting tools that sync across devices\n\n**General tech wisdom:**\n‚Ä¢ Don't upgrade devices yearly - waste of money\n‚Ä¢ Learn basic troubleshooting to save on repairs\n‚Ä¢ Use free alternatives to expensive software\n‚Ä¢ Automate repetitive tasks\n‚Ä¢ Backup everything important\n\nWhat specific tech question do you have? I can help with app recommendations, troubleshooting, or just chat about the latest trends!",
        "Technology questions? I'm here for it! üöÄ\n\n**Smart money moves with tech:**\n‚Ä¢ Use price comparison apps before buying\n‚Ä¢ Automate savings and investments\n‚Ä¢ Track expenses with apps (builds awareness)\n‚Ä¢ Use cashback and reward apps wisely\n‚Ä¢ Learn digital skills for side income\n\n**Tech life hacks:**\n‚Ä¢ Free courses online for any skill\n‚Ä¢ Open source alternatives save money\n‚Ä¢ Cloud storage for important documents\n‚Ä¢ Password managers for security\n‚Ä¢ Screen time limits for productivity\n\nTell me what you're curious about - specific apps, devices, online learning, digital finance tools? I'm genuinely interested in helping!"
      ];
      return techResponses[Math.floor(Math.random() * techResponses.length)];
    }

    // Career and work
    if (lowerMessage.includes('career') || lowerMessage.includes('job') || lowerMessage.includes('work') || lowerMessage.includes('salary')) {
      const careerResponses = [
        "Career conversations are my favorite! üöÄ\n\n**Financial career wisdom:**\n‚Ä¢ Salary is important, but growth potential matters more\n‚Ä¢ Build skills that increase your market value\n‚Ä¢ Network genuinely - help others first\n‚Ä¢ Document your achievements for reviews\n‚Ä¢ Always be learning something new\n\n**Money and career strategy:**\n1. **Negotiate salary** - research market rates first\n2. **Build emergency fund** - gives you negotiation power\n3. **Invest in skills** - highest ROI investment\n4. **Side hustles** - test business ideas, extra income\n5. **Plan career moves** - strategic job changes increase salary faster\n\n**Real talk:** Job security is dead. Build skill security instead. What career challenges are you facing? Let's strategize together!",
        "Let's talk career and money! üíº\n\n**Career financial planning:**\n‚Ä¢ Track your earning potential, not just current salary\n‚Ä¢ Invest 10% of income in skill development\n‚Ä¢ Build reputation in your field (LinkedIn, networking)\n‚Ä¢ Have 6-month emergency fund for career risks\n‚Ä¢ Consider freelancing/consulting for extra income\n\n**Salary negotiation tips:**\n1. Research market rates thoroughly\n2. Document your value/achievements\n3. Ask for more than salary (benefits, growth, flexibility)\n4. Practice the conversation\n5. Be prepared to walk away\n\n**Career investment mindset:** Every skill learned, relationship built, and risk taken compounds over time.\n\nWhat's your career situation? New graduate, career change, salary negotiation, or planning next steps? I can help you think through it!"
      ];
      return careerResponses[Math.floor(Math.random() * careerResponses.length)];
    }

    // Relationships and personal
    if (lowerMessage.includes('relationship') || lowerMessage.includes('family') || lowerMessage.includes('friend') || lowerMessage.includes('personal')) {
      const relationshipResponses = [
        "Relationships and money - such an important topic! üíï\n\n**Financial harmony in relationships:**\n‚Ä¢ Be transparent about money goals and habits\n‚Ä¢ Discuss big purchases before making them\n‚Ä¢ Both partners should understand finances\n‚Ä¢ Separate fun money accounts reduce conflicts\n‚Ä¢ Plan financial goals together\n\n**Personal finance psychology:**\n‚Ä¢ Money stress affects all relationships\n‚Ä¢ Financial security gives confidence\n‚Ä¢ Teaching kids about money is parenting\n‚Ä¢ Don't lend money you can't afford to lose\n‚Ä¢ Success is better shared\n\n**Life balance:** Making money is important, but relationships, health, and personal growth matter just as much. What's going on in your personal life? I'm here to listen and help however I can!",
        "Personal stuff matters! ü´Ç\n\n**Money and relationships reality:**\n‚Ä¢ Financial stress is a major relationship killer\n‚Ä¢ Different money values cause conflicts\n‚Ä¢ Financial independence gives relationship freedom\n‚Ä¢ Joint financial goals strengthen partnerships\n‚Ä¢ Money conversations should happen regularly\n\n**Personal growth and money:**\n1. **Self-worth affects financial decisions**\n2. **Emotional spending is real** - address the feelings\n3. **Financial therapy exists** - money triggers are normal\n4. **Success mindset takes practice**\n5. **Celebrate progress, not perfection**\n\nRemember: You're more than your bank balance. Your relationships, health, and happiness are the real wealth. What's on your heart today?"
      ];
      return relationshipResponses[Math.floor(Math.random() * relationshipResponses.length)];
    }

    // Fun and random questions
    if (lowerMessage.includes('fun') || lowerMessage.includes('joke') || lowerMessage.includes('tell me') || lowerMessage.includes('random')) {
      const funResponses = [
        "Fun time! üéâ Here's some financial humor for you:\n\n**Money jokes:**\n‚Ä¢ I told my wallet a joke about money... it didn't laugh because it was broke! üí∏\n‚Ä¢ Why don't money and secrets get along? Because money talks!\n‚Ä¢ My bank account and I have trust issues - it keeps saying 'insufficient funds' and I keep saying 'that's impossible!'\n\n**Fun financial facts:**\n‚Ä¢ The average person spends 5 years of their life thinking about money\n‚Ä¢ ATMs were originally called 'robot cashiers'\n‚Ä¢ The first credit card was made of cardboard\n\nWhat kind of fun stuff interests you? Random facts, jokes, weird money trivia, or something else entirely?",
        "Let's have some fun! üòÑ\n\n**Weird money facts:**\n‚Ä¢ Bill Gates' net worth increases by about $1,300 every second\n‚Ä¢ The most expensive pizza ever cost $12,000 (it had gold flakes!)\n‚Ä¢ If you saved ‚Çπ100 every day since the pyramids were built, you still wouldn't be a billionaire\n‚Ä¢ Monopoly money is printed more than real money in many countries\n\n**Financial wisdom disguised as fun:**\n‚Ä¢ Compound interest is the 8th wonder of the world\n‚Ä¢ Time is literally money when investing\n‚Ä¢ The best investment is often in yourself\n\nWhat's your idea of fun? I can chat about literally anything - movies, sports, travel, weird facts, life stories, whatever makes you smile!"
      ];
      return funResponses[Math.floor(Math.random() * funResponses.length)];
    }

    // Default comprehensive responses
    const comprehensiveResponses = [
      "I love getting all kinds of questions! ü§ó While I'm great with financial stuff, I'm honestly here to chat about anything that's on your mind:\n\n**I can help with:**\n‚Ä¢ Financial planning and budgeting\n‚Ä¢ Investment advice and calculations\n‚Ä¢ Career and life decisions\n‚Ä¢ Technology and productivity tips\n‚Ä¢ General life advice and motivation\n‚Ä¢ Random conversations and fun facts\n‚Ä¢ Problem-solving and brainstorming\n\nWhat's really on your mind today? Don't worry about staying on topic - I enjoy genuine conversations about whatever matters to you right now!",
      
      "Hey, I'm here for whatever you need! üí´ Your question might not be directly about money, but that's totally okay:\n\n**Things I love discussing:**\n‚Ä¢ Life goals and how to achieve them\n‚Ä¢ Practical advice for everyday challenges\n‚Ä¢ Learning and skill development\n‚Ä¢ Relationships and personal growth\n‚Ä¢ Technology and its impact on life\n‚Ä¢ Career strategies and planning\n‚Ä¢ Creative problem-solving\n‚Ä¢ Just having a genuine conversation!\n\nI'm built to be helpful, friendly, and actually useful. So whether it's a serious question, random thought, or you just want to chat - I'm genuinely interested. What's going on with you?",
      
      "You know what? I really enjoy when people ask me anything! üåü Sure, I'm great with financial advice, but I'm honestly just here to be helpful:\n\n**Real talk:** Life isn't just about money. It's about relationships, growth, purpose, health, creativity, and finding happiness. I can chat about:\n\n‚Ä¢ Personal challenges you're facing\n‚Ä¢ Goals you're working towards\n‚Ä¢ Decisions you're trying to make\n‚Ä¢ Skills you want to develop\n‚Ä¢ Ideas you're exploring\n‚Ä¢ Problems you need to solve\n‚Ä¢ Or literally just random thoughts!\n\nI'm designed to be genuinely helpful and have real conversations. So what's actually on your mind today? I'm here to listen and help however I can!",
      
      "I appreciate you reaching out! üòä Honestly, I'm here for any kind of conversation:\n\n**My philosophy:** Everyone's dealing with something, working towards something, or curious about something. Whether it's:\n\n‚Ä¢ Financial stress or goals\n‚Ä¢ Career decisions or challenges\n‚Ä¢ Relationship questions\n‚Ä¢ Personal development\n‚Ä¢ Learning new things\n‚Ä¢ Technology and productivity\n‚Ä¢ Health and lifestyle\n‚Ä¢ Creative projects\n‚Ä¢ Random curiosity\n\nI genuinely want to be helpful. I'll give you honest, practical advice based on real-world experience and common sense. No judgment, no complicated jargon - just a friendly conversation.\n\nSo, what's really going on? What can I help you think through today?"
    ];
    
    return comprehensiveResponses[Math.floor(Math.random() * comprehensiveResponses.length)];
  };

  const handleSendMessage = async () => {
    if (!inputMessage.trim()) return;

    const userMessage = {
      id: Date.now(),
      type: 'user',
      content: inputMessage,
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    setInputMessage('');
    setIsTyping(true);

    // Simulate typing delay
    setTimeout(() => {
      const botResponse = {
        id: Date.now() + 1,
        type: 'bot',
        content: generateResponse(inputMessage),
        timestamp: new Date()
      };
      setMessages(prev => [...prev, botResponse]);
      setIsTyping(false);
    }, 1000 + Math.random() * 1000);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  const formatTime = (date) => {
    return new Intl.DateTimeFormat('en-IN', {
      hour: '2-digit',
      minute: '2-digit',
      hour12: true
    }).format(date);
  };

  if (!isOpen) {
    return (
      <button
        onClick={() => setIsOpen(true)}
        className="fixed bottom-6 right-6 bg-gradient-to-r from-primary-500 to-primary-600 text-white p-4 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110 z-50 animate-pulse"
      >
        <MessageCircle className="w-6 h-6" />
      </button>
    );
  }

  return (
    <div className={`fixed transition-all duration-300 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 flex flex-col z-50 animate-slide-up ${
      isExpanded 
        ? 'bottom-6 right-6 left-6 top-6 md:left-1/4' 
        : 'bottom-6 right-6 w-96 h-[500px]'
    }`}>
      {/* Header */}
      <div className="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-primary-500 to-primary-600 rounded-t-2xl">
        <div className="flex items-center space-x-3">
          <div className="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
            <Sparkles className="w-4 h-4 text-white" />
          </div>
          <div>
            <h3 className="font-semibold text-white">SmartJeb AI Assistant</h3>
            <p className="text-xs text-white/80">Your intelligent financial companion</p>
          </div>
        </div>
        <div className="flex items-center space-x-2">
          <button
            onClick={() => setIsExpanded(!isExpanded)}
            className="text-white/80 hover:text-white transition-colors duration-200 hover:bg-white/10 rounded-lg p-1"
            title={isExpanded ? "Minimize" : "Expand"}
          >
            {isExpanded ? (
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 8V4m0 0h4M4 4l5 5m11-5v4m0-4h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
              </svg>
            ) : (
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 8V4m0 0h4M4 4l5 5m11-5v4m0-4h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
              </svg>
            )}
          </button>
          <button
            onClick={() => setIsOpen(false)}
            className="text-white/80 hover:text-white transition-colors duration-200 hover:bg-white/10 rounded-lg p-1"
          >
            <X className="w-5 h-5" />
          </button>
        </div>
      </div>

      {/* Messages */}
      <div className="flex-1 overflow-y-auto p-4 space-y-4">
        {messages.map((message) => (
          <div
            key={message.id}
            className={`flex ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}
          >
            <div className={`flex items-start space-x-2 ${
              isExpanded ? 'max-w-[70%]' : 'max-w-[80%]'
            } ${message.type === 'user' ? 'flex-row-reverse space-x-reverse' : ''}`}>
              <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${
                message.type === 'user' 
                  ? 'bg-primary-500' 
                  : 'bg-gradient-to-r from-purple-500 to-pink-500'
              }`}>
                {message.type === 'user' ? (
                  <User className="w-4 h-4 text-white" />
                ) : (
                  <Bot className="w-4 h-4 text-white" />
                )}
              </div>
              <div className={`rounded-2xl p-3 ${
                message.type === 'user'
                  ? 'bg-primary-500 text-white rounded-tr-md'
                  : 'bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-tl-md'
              }`}>
                <p className="text-sm whitespace-pre-wrap">{message.content}</p>
                <p className={`text-xs mt-1 ${
                  message.type === 'user' ? 'text-white/70' : 'text-gray-500 dark:text-gray-400'
                }`}>
                  {formatTime(message.timestamp)}
                </p>
              </div>
            </div>
          </div>
        ))}
        
        {isTyping && (
          <div className="flex justify-start">
            <div className="flex items-start space-x-2 max-w-[80%]">
              <div className="w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center flex-shrink-0">
                <Bot className="w-4 h-4 text-white" />
              </div>
              <div className="bg-gray-100 dark:bg-gray-700 rounded-2xl rounded-tl-md p-3">
                <div className="flex space-x-1">
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                </div>
              </div>
            </div>
          </div>
        )}
        <div ref={messagesEndRef} />
      </div>

      {/* Input */}
      <div className="p-4 border-t border-gray-200 dark:border-gray-700">
        <div className="flex space-x-2">
          <textarea
            value={inputMessage}
            onChange={(e) => setInputMessage(e.target.value)}
            onKeyPress={handleKeyPress}
            placeholder="Ask me about budgeting, savings, or money tips..."
            className={`flex-1 resize-none rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm ${
              isExpanded ? 'min-h-[60px]' : ''
            }`}
            rows={isExpanded ? "3" : "2"}
          />
          <button
            onClick={handleSendMessage}
            disabled={!inputMessage.trim() || isTyping}
            className="bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 dark:disabled:bg-gray-600 text-white p-2 rounded-xl transition-colors duration-200 self-end"
          >
            <Send className="w-4 h-4" />
          </button>
        </div>
      </div>
    </div>
  );
};

export default AIChatbot;
